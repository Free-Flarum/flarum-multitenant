{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@clarkwinkelmann/group-invitation/webpack/bootstrap","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/define property getters","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['admin/app']\"","webpack://@clarkwinkelmann/group-invitation/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/group-invitation/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/Model']\"","webpack://@clarkwinkelmann/group-invitation/./src/common/Invitation.ts","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/components/GroupBadge']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/models/Group']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@clarkwinkelmann/group-invitation/./src/admin/components/GroupSelect.ts","webpack://@clarkwinkelmann/group-invitation/./src/admin/components/SettingsPage.ts","webpack://@clarkwinkelmann/group-invitation/./src/admin/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\nimport Group from 'flarum/common/models/Group';\n\nexport default class Invitation extends Model {\n    code = Model.attribute<string>('code');\n    hasUsagesLeft = Model.attribute<boolean>('hasUsagesLeft');\n    canUse = Model.attribute<boolean>('canUse');\n    usageCount = Model.attribute<number>('usageCount');\n    maxUsage = Model.attribute<number>('maxUsage');\n    createdAt = Model.attribute('createdAt', Model.transformDate);\n\n    group = Model.hasOne<Group>('group');\n\n    apiEndpoint() {\n        return '/group-invitations' + (this.exists ? '/' + (this.data as any).id : '');\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/GroupBadge'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import {ClassComponent, Vnode} from 'mithril';\nimport app from 'flarum/admin/app';\nimport Group from 'flarum/common/models/Group';\nimport icon from 'flarum/common/helpers/icon';\n\ninterface GroupSelectAttrs {\n    onchange: (value: string) => void\n    value: string\n}\n\nexport default class GroupSelect implements ClassComponent<GroupSelectAttrs> {\n    view(vnode: Vnode<GroupSelectAttrs, this>) {\n        const {\n            onchange,\n            value,\n        } = vnode.attrs;\n\n        return m('span.Select', [\n            m('select.Select-input.FormControl', {\n                onchange: (event: Event) => {\n                    onchange((event.target as HTMLInputElement).value);\n                },\n                value,\n            }, [\n                m('option', {\n                    value: '',\n                    disabled: true,\n                    hidden: true,\n                }, app.translator.trans('clarkwinkelmann-group-invitation.admin.settings.placeholder.group')),\n                app.store\n                    .all<Group>('groups')\n                    .filter((group) => [Group.GUEST_ID, Group.MEMBER_ID].indexOf(group.id()!) === -1)\n                    .map((group) => m('option', {\n                        value: group.id()\n                    }, group.namePlural())),\n            ]),\n            icon('fas fa-sort', {className: 'Select-caret'}),\n        ]);\n    }\n}\n","import {Vnode} from 'mithril';\nimport app from 'flarum/admin/app';\nimport {ApiPayloadSingle} from 'flarum/common/Store';\nimport Button from 'flarum/common/components/Button';\nimport GroupBadge from 'flarum/common/components/GroupBadge';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport GroupSelect from './GroupSelect';\nimport Invitation from '../../common/Invitation';\n\nconst translationPrefix = 'clarkwinkelmann-group-invitation.admin.settings.';\n\nexport default class SettingsPage extends ExtensionPage {\n    invitations: Invitation[] | null = null;\n    newInvitationGroupId: string = '';\n    newInvitationMaxUsage: string = '';\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        app.store.find<Invitation[]>('group-invitations', {}).then(invitations => {\n            this.invitations = invitations;\n            m.redraw();\n        });\n\n        this.loading = false;\n    }\n\n    content() {\n        return m('.ExtensionPage-settings.GroupInvitationSettingsPage', m('.container', [\n            m('table', [\n                m('thead', m('tr', [\n                    m('th', app.translator.trans(translationPrefix + 'head.code')),\n                    m('th', app.translator.trans(translationPrefix + 'head.group')),\n                    m('th', app.translator.trans(translationPrefix + 'head.usage')),\n                    m('th'),\n                ])),\n                m('tbody', [\n                    this.invitations === null ? m('tr', m('td', LoadingIndicator.component())) : [\n                        this.invitations.map((invitation, index) => {\n                            const group = invitation.group();\n\n                            return m('tr', [\n                                m('td', m('a', {\n                                    href: app.forum.attribute('baseUrl') + '/get-role/' + invitation.code(),\n                                    target: '_blank',\n                                }, m('code', invitation.code()))),\n                                m('td', [\n                                    GroupBadge.component({\n                                        group,\n                                    }),\n                                    ' ',\n                                    group && group.namePlural(),\n                                ]),\n                                m('td', invitation.usageCount() + '/' + (invitation.maxUsage() === null ? app.translator.trans(translationPrefix + 'unlimited') : invitation.maxUsage())),\n                                m('td', Button.component({\n                                    className: 'Button Button--danger',\n                                    onclick: () => {\n                                        this.loading = true;\n\n                                        invitation.delete().then(() => {\n                                            this.loading = false;\n\n                                            this.invitations!.splice(index, 1);\n                                            m.redraw();\n                                        }).catch(e => {\n                                            this.loading = false;\n                                            m.redraw();\n                                            throw e;\n                                        });\n                                    },\n                                    loading: this.loading,\n                                }, app.translator.trans(translationPrefix + 'delete'))),\n                            ]);\n                        }),\n                        this.invitations.length === 0 ? m('tr.NoResultRow', m('td', {\n                            colspan: 4,\n                        }, m('em', app.translator.trans(translationPrefix + 'empty')))) : null,\n                    ],\n                    m('tr', [\n                        m('td', m('em', app.translator.trans(translationPrefix + 'placeholder.code'))),\n                        m('td', m(GroupSelect, {\n                            onchange: (value: string) => {\n                                this.newInvitationGroupId = value;\n                            },\n                            value: this.newInvitationGroupId,\n                        })),\n                        m('td', m('input.FormControl', {\n                            type: 'number',\n                            min: '0',\n                            onchange: (event: Event) => {\n                                const value = (event.target as HTMLInputElement).value;\n                                this.newInvitationMaxUsage = value === '0' ? '' : value;\n                            },\n                            value: this.newInvitationMaxUsage,\n                            placeholder: app.translator.trans(translationPrefix + 'placeholder.usage'),\n                        })),\n                        m('td', Button.component({\n                            className: 'Button Button--primary',\n                            onclick: () => {\n                                this.loading = true;\n\n                                app.request<ApiPayloadSingle>({\n                                    method: 'POST',\n                                    url: app.forum.attribute('apiUrl') + '/group-invitations',\n                                    body: {\n                                        groupId: this.newInvitationGroupId,\n                                        maxUsage: this.newInvitationMaxUsage,\n                                    }\n                                }).then(data => {\n                                    this.loading = false;\n\n                                    this.invitations!.push(app.store.pushPayload(data));\n                                    this.newInvitationGroupId = '';\n                                    this.newInvitationMaxUsage = '';\n                                    m.redraw();\n                                }).catch(e => {\n                                    this.loading = false;\n                                    m.redraw();\n                                    throw e;\n                                });\n                            },\n                            loading: this.loading,\n                            disabled: !this.newInvitationGroupId,\n                        }, app.translator.trans(translationPrefix + 'create'))),\n                    ]),\n                ]),\n            ]),\n        ]));\n    }\n}\n","import app from 'flarum/admin/app';\nimport Invitation from '../common/Invitation';\nimport SettingsPage from './components/SettingsPage';\n\napp.initializers.add('clarkwinkelmann-group-invitation', () => {\n    app.store.models['group-invitations'] = Invitation;\n\n    app.extensionData.for('clarkwinkelmann-group-invitation')\n        .registerPage(SettingsPage)\n        .registerPermission({\n            icon: 'fas fa-certificate',\n            label: app.translator.trans('clarkwinkelmann-group-invitation.admin.permissions.use'),\n            permission: 'clarkwinkelmann-group-invitation.use',\n        }, 'start');\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","Invitation","code","Model","hasUsagesLeft","canUse","usageCount","maxUsage","createdAt","group","apiEndpoint","this","exists","data","id","GroupSelect","view","vnode","attrs","onchange","m","event","target","disabled","hidden","app","filter","Group","indexOf","map","namePlural","icon","className","translationPrefix","SettingsPage","invitations","newInvitationGroupId","newInvitationMaxUsage","oninit","then","redraw","loading","content","LoadingIndicator","invitation","index","href","GroupBadge","Button","onclick","splice","e","length","colspan","type","min","placeholder","method","url","body","groupId","push","ExtensionPage","registerPage","registerPermission","label","permission"],"sourceRoot":""}